<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KÃ¼tÃ¼phane Otomasyon Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        header h1 {
            color: #1e3c72;
            font-size: 2em;
        }

        header p {
            color: #666;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 15px 30px;
            border: none;
            background: white;
            color: #1e3c72;
            font-size: 1em;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab-btn:hover, .tab-btn.active {
            background: #1e3c72;
            color: white;
            transform: translateY(-2px);
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h2 {
            color: #1e3c72;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #1e3c72;
            color: white;
        }

        .btn-primary:hover {
            background: #2a5298;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-box input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .search-box input:focus {
            outline: none;
            border-color: #1e3c72;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            color: #1e3c72;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-available {
            background: #d4edda;
            color: #155724;
        }

        .status-borrowed {
            background: #f8d7da;
            color: #721c24;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #1e3c72;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .action-btns {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-btns .btn {
            padding: 8px 15px;
            font-size: 0.85em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                min-width: 120px;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“š KÃ¼tÃ¼phane Otomasyon Sistemi</h1>
            <p>Kitap ve Ã¼ye yÃ¶netimi iÃ§in basit ve etkili Ã§Ã¶zÃ¼m</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">ðŸ“Š Dashboard</button>
            <button class="tab-btn" onclick="showTab('kitaplar')">ðŸ“– Kitaplar</button>
            <button class="tab-btn" onclick="showTab('uyeler')">ðŸ‘¥ Ãœyeler</button>
            <button class="tab-btn" onclick="showTab('odunc')">ðŸ”„ Ã–dÃ¼nÃ§ Ä°ÅŸlemleri</button>
        </div>

        <div class="content">
            <div id="alert" class="alert"></div>

            <!-- Dashboard -->
            <div id="dashboard" class="tab-content active">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">ðŸ“Š Genel BakÄ±ÅŸ</h2>
                <div class="stats">
                    <div class="stat-card">
                        <h3 id="totalBooks">0</h3>
                        <p>Toplam Kitap</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                        <h3 id="availableBooks">0</h3>
                        <p>MÃ¼sait Kitap</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);">
                        <h3 id="borrowedBooks">0</h3>
                        <p>Ã–dÃ¼nÃ§ Verilen</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);">
                        <h3 id="totalMembers">0</h3>
                        <p>Toplam Ãœye</p>
                    </div>
                </div>

                <h3 style="color: #1e3c72; margin-bottom: 15px;">ðŸ“• Ã–dÃ¼nÃ§ AlÄ±nan Kitaplar</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Kitap</th>
                            <th>Yazar</th>
                            <th>Ã–dÃ¼nÃ§ Alan</th>
                            <th>Ä°ade Tarihi</th>
                        </tr>
                    </thead>
                    <tbody id="borrowedBooksTable">
                    </tbody>
                </table>
            </div>

            <!-- Kitaplar -->
            <div id="kitaplar" class="tab-content">
                <div class="section-header">
                    <h2>ðŸ“– Kitap YÃ¶netimi</h2>
                    <button class="btn btn-primary" onclick="openModal('kitapModal')">+ Yeni Kitap Ekle</button>
                </div>
                <div class="search-box">
                    <input type="text" id="kitapArama" placeholder="Kitap adÄ± veya yazar ara...">
                    <button class="btn btn-primary" onclick="kitapAra()">Ara</button>
                    <button class="btn btn-info" onclick="loadKitaplar()">TÃ¼mÃ¼nÃ¼ GÃ¶ster</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ISBN</th>
                            <th>BaÅŸlÄ±k</th>
                            <th>Yazar</th>
                            <th>YayÄ±nevi</th>
                            <th>YÄ±l</th>
                            <th>Durum</th>
                            <th>Ä°ÅŸlemler</th>
                        </tr>
                    </thead>
                    <tbody id="kitaplarTable">
                    </tbody>
                </table>
            </div>

            <!-- Ãœyeler -->
            <div id="uyeler" class="tab-content">
                <div class="section-header">
                    <h2>ðŸ‘¥ Ãœye YÃ¶netimi</h2>
                    <button class="btn btn-primary" onclick="openModal('uyeModal')">+ Yeni Ãœye Ekle</button>
                </div>
                <div class="search-box">
                    <input type="text" id="uyeArama" placeholder="Ãœye adÄ± ara...">
                    <button class="btn btn-primary" onclick="uyeAra()">Ara</button>
                    <button class="btn btn-info" onclick="loadUyeler()">TÃ¼mÃ¼nÃ¼ GÃ¶ster</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ãœye No</th>
                            <th>Ad Soyad</th>
                            <th>Email</th>
                            <th>Telefon</th>
                            <th>Ã–dÃ¼nÃ§ Kitap</th>
                            <th>Ä°ÅŸlemler</th>
                        </tr>
                    </thead>
                    <tbody id="uyelerTable">
                    </tbody>
                </table>
            </div>

            <!-- Ã–dÃ¼nÃ§ Ä°ÅŸlemleri -->
            <div id="odunc" class="tab-content">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">ðŸ”„ Ã–dÃ¼nÃ§ Verme / Ä°ade Ä°ÅŸlemleri</h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                    <!-- Ã–dÃ¼nÃ§ Verme -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px;">
                        <h3 style="color: #28a745; margin-bottom: 20px;">ðŸ“¤ Kitap Ã–dÃ¼nÃ§ Ver</h3>
                        <div class="form-group">
                            <label>Kitap SeÃ§in</label>
                            <select id="oduncKitap">
                                <option value="">-- Kitap SeÃ§in --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ãœye SeÃ§in</label>
                            <select id="oduncUye">
                                <option value="">-- Ãœye SeÃ§in --</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="kitapOduncVer()" style="width: 100%;">Ã–dÃ¼nÃ§ Ver</button>
                    </div>

                    <!-- Ä°ade -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px;">
                        <h3 style="color: #dc3545; margin-bottom: 20px;">ðŸ“¥ Kitap Ä°ade Al</h3>
                        <div class="form-group">
                            <label>Ä°ade Edilecek Kitap</label>
                            <select id="iadeKitap">
                                <option value="">-- Kitap SeÃ§in --</option>
                            </select>
                        </div>
                        <button class="btn btn-danger" onclick="kitapIadeAl()" style="width: 100%;">Ä°ade Al</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kitap Modal -->
    <div id="kitapModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="kitapModalTitle">Yeni Kitap Ekle</h3>
                <button class="close-btn" onclick="closeModal('kitapModal')">&times;</button>
            </div>
            <form id="kitapForm">
                <input type="hidden" id="kitapId">
                <div class="form-group">
                    <label>ISBN</label>
                    <input type="text" id="kitapIsbn" required placeholder="978-XXX-XXXX-XX-X">
                </div>
                <div class="form-group">
                    <label>Kitap BaÅŸlÄ±ÄŸÄ±</label>
                    <input type="text" id="kitapBaslik" required placeholder="Kitap adÄ±nÄ± girin">
                </div>
                <div class="form-group">
                    <label>Yazar</label>
                    <input type="text" id="kitapYazar" required placeholder="Yazar adÄ±nÄ± girin">
                </div>
                <div class="form-group">
                    <label>YayÄ±nevi</label>
                    <input type="text" id="kitapYayinevi" placeholder="YayÄ±nevi adÄ±nÄ± girin">
                </div>
                <div class="form-group">
                    <label>YayÄ±n YÄ±lÄ±</label>
                    <input type="number" id="kitapYayinYili" placeholder="2024">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Kaydet</button>
            </form>
        </div>
    </div>

    <!-- Ãœye Modal -->
    <div id="uyeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="uyeModalTitle">Yeni Ãœye Ekle</h3>
                <button class="close-btn" onclick="closeModal('uyeModal')">&times;</button>
            </div>
            <form id="uyeForm">
                <input type="hidden" id="uyeId">
                <div class="form-group">
                    <label>Ad</label>
                    <input type="text" id="uyeAd" required placeholder="AdÄ±nÄ± girin">
                </div>
                <div class="form-group">
                    <label>Soyad</label>
                    <input type="text" id="uyeSoyad" required placeholder="SoyadÄ±nÄ± girin">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="uyeEmail" placeholder="email@example.com">
                </div>
                <div class="form-group">
                    <label>Telefon</label>
                    <input type="text" id="uyeTelefon" placeholder="555-XXX-XXXX">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Kaydet</button>
            </form>
        </div>
    </div>

    <script>
        const API_URL = '/api';

        // Tab iÅŸlemleri
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');

            if (tabId === 'dashboard') loadDashboard();
            if (tabId === 'kitaplar') loadKitaplar();
            if (tabId === 'uyeler') loadUyeler();
            if (tabId === 'odunc') loadOduncSecenekleri();
        }

        // Modal iÅŸlemleri
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            if (modalId === 'kitapModal') {
                document.getElementById('kitapForm').reset();
                document.getElementById('kitapId').value = '';
                document.getElementById('kitapModalTitle').textContent = 'Yeni Kitap Ekle';
            }
            if (modalId === 'uyeModal') {
                document.getElementById('uyeForm').reset();
                document.getElementById('uyeId').value = '';
                document.getElementById('uyeModalTitle').textContent = 'Yeni Ãœye Ekle';
            }
        }

        // Alert gÃ¶ster
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = 'alert alert-' + type;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 3000);
        }

        // Dashboard yÃ¼kle
        async function loadDashboard() {
            try {
                const [kitaplar, uyeler, oduncAlinan] = await Promise.all([
                    fetch(API_URL + '/kitaplar').then(r => r.json()),
                    fetch(API_URL + '/uyeler').then(r => r.json()),
                    fetch(API_URL + '/kitaplar/odunc-alinan').then(r => r.json())
                ]);

                document.getElementById('totalBooks').textContent = kitaplar.length;
                document.getElementById('availableBooks').textContent = kitaplar.filter(k => !k.oduncAlindi).length;
                document.getElementById('borrowedBooks').textContent = oduncAlinan.length;
                document.getElementById('totalMembers').textContent = uyeler.length;

                const tbody = document.getElementById('borrowedBooksTable');
                tbody.innerHTML = oduncAlinan.map(k => `
                    <tr>
                        <td>${k.baslik}</td>
                        <td>${k.yazar}</td>
                        <td>${k.oduncAlanUye || '-'}</td>
                        <td>${k.iadeTarihi || '-'}</td>
                    </tr>
                `).join('') || '<tr><td colspan="4" style="text-align:center;">Ã–dÃ¼nÃ§ alÄ±nan kitap yok</td></tr>';
            } catch (error) {
                showAlert('Veriler yÃ¼klenirken hata oluÅŸtu!', 'error');
            }
        }

        // KitaplarÄ± yÃ¼kle
        async function loadKitaplar() {
            try {
                const response = await fetch(API_URL + '/kitaplar');
                const kitaplar = await response.json();
                renderKitaplar(kitaplar);
            } catch (error) {
                showAlert('Kitaplar yÃ¼klenirken hata oluÅŸtu!', 'error');
            }
        }

        function renderKitaplar(kitaplar) {
            const tbody = document.getElementById('kitaplarTable');
            tbody.innerHTML = kitaplar.map(k => `
                <tr>
                    <td>${k.id}</td>
                    <td>${k.isbn}</td>
                    <td>${k.baslik}</td>
                    <td>${k.yazar}</td>
                    <td>${k.yayinevi || '-'}</td>
                    <td>${k.yayinYili || '-'}</td>
                    <td><span class="status ${k.oduncAlindi ? 'status-borrowed' : 'status-available'}">${k.oduncAlindi ? 'Ã–dÃ¼nÃ§ AlÄ±ndÄ±' : 'MÃ¼sait'}</span></td>
                    <td>
                        <div class="action-btns">
                            <button class="btn btn-warning" onclick="kitapDuzenle(${k.id})">DÃ¼zenle</button>
                            <button class="btn btn-danger" onclick="kitapSil(${k.id})">Sil</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Kitap ara
        async function kitapAra() {
            const query = document.getElementById('kitapArama').value;
            if (!query) return loadKitaplar();

            try {
                const [baslik, yazar] = await Promise.all([
                    fetch(API_URL + '/kitaplar/ara/baslik?q=' + encodeURIComponent(query)).then(r => r.json()),
                    fetch(API_URL + '/kitaplar/ara/yazar?q=' + encodeURIComponent(query)).then(r => r.json())
                ]);

                const combined = [...baslik, ...yazar];
                const unique = combined.filter((k, i, arr) => arr.findIndex(x => x.id === k.id) === i);
                renderKitaplar(unique);
            } catch (error) {
                showAlert('Arama sÄ±rasÄ±nda hata oluÅŸtu!', 'error');
            }
        }

        // Kitap kaydet
        document.getElementById('kitapForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const kitap = {
                isbn: document.getElementById('kitapIsbn').value,
                baslik: document.getElementById('kitapBaslik').value,
                yazar: document.getElementById('kitapYazar').value,
                yayinevi: document.getElementById('kitapYayinevi').value,
                yayinYili: parseInt(document.getElementById('kitapYayinYili').value) || 0
            };

            const id = document.getElementById('kitapId').value;
            const url = id ? API_URL + '/kitaplar/' + id : API_URL + '/kitaplar';
            const method = id ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(kitap)
                });

                if (response.ok) {
                    showAlert(id ? 'Kitap gÃ¼ncellendi!' : 'Kitap eklendi!', 'success');
                    closeModal('kitapModal');
                    loadKitaplar();
                } else {
                    showAlert('Ä°ÅŸlem baÅŸarÄ±sÄ±z!', 'error');
                }
            } catch (error) {
                showAlert('Bir hata oluÅŸtu!', 'error');
            }
        });

        // Kitap dÃ¼zenle
        async function kitapDuzenle(id) {
            try {
                const response = await fetch(API_URL + '/kitaplar/' + id);
                const kitap = await response.json();

                document.getElementById('kitapId').value = kitap.id;
                document.getElementById('kitapIsbn').value = kitap.isbn;
                document.getElementById('kitapBaslik').value = kitap.baslik;
                document.getElementById('kitapYazar').value = kitap.yazar;
                document.getElementById('kitapYayinevi').value = kitap.yayinevi || '';
                document.getElementById('kitapYayinYili').value = kitap.yayinYili || '';
                document.getElementById('kitapModalTitle').textContent = 'Kitap DÃ¼zenle';
                openModal('kitapModal');
            } catch (error) {
                showAlert('Kitap bilgileri alÄ±namadÄ±!', 'error');
            }
        }

        // Kitap sil
        async function kitapSil(id) {
            if (!confirm('Bu kitabÄ± silmek istediÄŸinizden emin misiniz?')) return;

            try {
                const response = await fetch(API_URL + '/kitaplar/' + id, { method: 'DELETE' });
                const result = await response.json();

                if (response.ok) {
                    showAlert(result.mesaj, 'success');
                    loadKitaplar();
                } else {
                    showAlert(result.mesaj, 'error');
                }
            } catch (error) {
                showAlert('Silme iÅŸlemi baÅŸarÄ±sÄ±z!', 'error');
            }
        }

        // Ãœyeleri yÃ¼kle
        async function loadUyeler() {
            try {
                const response = await fetch(API_URL + '/uyeler');
                const uyeler = await response.json();
                renderUyeler(uyeler);
            } catch (error) {
                showAlert('Ãœyeler yÃ¼klenirken hata oluÅŸtu!', 'error');
            }
        }

        function renderUyeler(uyeler) {
            const tbody = document.getElementById('uyelerTable');
            tbody.innerHTML = uyeler.map(u => `
                <tr>
                    <td>${u.id}</td>
                    <td>${u.uyeNo}</td>
                    <td>${u.ad} ${u.soyad}</td>
                    <td>${u.email || '-'}</td>
                    <td>${u.telefon || '-'}</td>
                    <td>${u.oduncAlinanKitaplar ? u.oduncAlinanKitaplar.length : 0}</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn btn-warning" onclick="uyeDuzenle(${u.id})">DÃ¼zenle</button>
                            <button class="btn btn-danger" onclick="uyeSil(${u.id})">Sil</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Ãœye ara
        async function uyeAra() {
            const query = document.getElementById('uyeArama').value;
            if (!query) return loadUyeler();

            try {
                const response = await fetch(API_URL + '/uyeler/ara?q=' + encodeURIComponent(query));
                const uyeler = await response.json();
                renderUyeler(uyeler);
            } catch (error) {
                showAlert('Arama sÄ±rasÄ±nda hata oluÅŸtu!', 'error');
            }
        }

        // Ãœye kaydet
        document.getElementById('uyeForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const uye = {
                ad: document.getElementById('uyeAd').value,
                soyad: document.getElementById('uyeSoyad').value,
                email: document.getElementById('uyeEmail').value,
                telefon: document.getElementById('uyeTelefon').value
            };

            const id = document.getElementById('uyeId').value;
            const url = id ? API_URL + '/uyeler/' + id : API_URL + '/uyeler';
            const method = id ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(uye)
                });

                if (response.ok) {
                    showAlert(id ? 'Ãœye gÃ¼ncellendi!' : 'Ãœye eklendi!', 'success');
                    closeModal('uyeModal');
                    loadUyeler();
                } else {
                    showAlert('Ä°ÅŸlem baÅŸarÄ±sÄ±z!', 'error');
                }
            } catch (error) {
                showAlert('Bir hata oluÅŸtu!', 'error');
            }
        });

        // Ãœye dÃ¼zenle
        async function uyeDuzenle(id) {
            try {
                const response = await fetch(API_URL + '/uyeler/' + id);
                const uye = await response.json();

                document.getElementById('uyeId').value = uye.id;
                document.getElementById('uyeAd').value = uye.ad;
                document.getElementById('uyeSoyad').value = uye.soyad;
                document.getElementById('uyeEmail').value = uye.email || '';
                document.getElementById('uyeTelefon').value = uye.telefon || '';
                document.getElementById('uyeModalTitle').textContent = 'Ãœye DÃ¼zenle';
                openModal('uyeModal');
            } catch (error) {
                showAlert('Ãœye bilgileri alÄ±namadÄ±!', 'error');
            }
        }

        // Ãœye sil
        async function uyeSil(id) {
            if (!confirm('Bu Ã¼yeyi silmek istediÄŸinizden emin misiniz?')) return;

            try {
                const response = await fetch(API_URL + '/uyeler/' + id, { method: 'DELETE' });
                const result = await response.json();

                if (response.ok) {
                    showAlert(result.mesaj, 'success');
                    loadUyeler();
                } else {
                    showAlert(result.mesaj, 'error');
                }
            } catch (error) {
                showAlert('Silme iÅŸlemi baÅŸarÄ±sÄ±z!', 'error');
            }
        }

        // Ã–dÃ¼nÃ§ seÃ§eneklerini yÃ¼kle
        async function loadOduncSecenekleri() {
            try {
                const [musaitKitaplar, uyeler, oduncKitaplar] = await Promise.all([
                    fetch(API_URL + '/kitaplar/musait').then(r => r.json()),
                    fetch(API_URL + '/uyeler').then(r => r.json()),
                    fetch(API_URL + '/kitaplar/odunc-alinan').then(r => r.json())
                ]);

                const oduncKitapSelect = document.getElementById('oduncKitap');
                oduncKitapSelect.innerHTML = '<option value="">-- Kitap SeÃ§in --</option>' +
                    musaitKitaplar.map(k => `<option value="${k.id}">${k.baslik} - ${k.yazar}</option>`).join('');

                const oduncUyeSelect = document.getElementById('oduncUye');
                oduncUyeSelect.innerHTML = '<option value="">-- Ãœye SeÃ§in --</option>' +
                    uyeler.map(u => `<option value="${u.id}">${u.ad} ${u.soyad} (${u.uyeNo})</option>`).join('');

                const iadeKitapSelect = document.getElementById('iadeKitap');
                iadeKitapSelect.innerHTML = '<option value="">-- Kitap SeÃ§in --</option>' +
                    oduncKitaplar.map(k => `<option value="${k.id}">${k.baslik} - ${k.oduncAlanUye}</option>`).join('');
            } catch (error) {
                showAlert('Veriler yÃ¼klenirken hata oluÅŸtu!', 'error');
            }
        }

        // Kitap Ã¶dÃ¼nÃ§ ver
        async function kitapOduncVer() {
            const kitapId = document.getElementById('oduncKitap').value;
            const uyeId = document.getElementById('oduncUye').value;

            if (!kitapId || !uyeId) {
                showAlert('LÃ¼tfen kitap ve Ã¼ye seÃ§in!', 'error');
                return;
            }

            try {
                const response = await fetch(API_URL + '/kitaplar/' + kitapId + '/odunc-ver/' + uyeId, {
                    method: 'POST'
                });
                const result = await response.json();

                if (response.ok) {
                    showAlert(result.mesaj, 'success');
                    loadOduncSecenekleri();
                } else {
                    showAlert(result.mesaj, 'error');
                }
            } catch (error) {
                showAlert('Ä°ÅŸlem baÅŸarÄ±sÄ±z!', 'error');
            }
        }

        // Kitap iade al
        async function kitapIadeAl() {
            const kitapId = document.getElementById('iadeKitap').value;

            if (!kitapId) {
                showAlert('LÃ¼tfen iade edilecek kitabÄ± seÃ§in!', 'error');
                return;
            }

            try {
                const response = await fetch(API_URL + '/kitaplar/' + kitapId + '/iade', {
                    method: 'POST'
                });
                const result = await response.json();

                if (response.ok) {
                    showAlert(result.mesaj, 'success');
                    loadOduncSecenekleri();
                } else {
                    showAlert(result.mesaj, 'error');
                }
            } catch (error) {
                showAlert('Ä°ÅŸlem baÅŸarÄ±sÄ±z!', 'error');
            }
        }

        // Sayfa yÃ¼klendiÄŸinde dashboard'u yÃ¼kle
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
        });
    </script>
</body>
</html>

